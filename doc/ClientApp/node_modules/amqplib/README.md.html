<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "ClientApp\\node_modules\\amqplib\\README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#amqp-0-9-1-library-and-client-for-node.js">AMQP 0-9-1 library and client for Node.JS</a>
      </div>

      <div class="heading h2">
        <a href="#callback-api-example">Callback API example</a>
      </div>

      <div class="heading h2">
        <a href="#promise-api-example">Promise API example</a>
      </div>

      <div class="heading h2">
        <a href="#running-tests">Running tests</a>
      </div>

      <div class="heading h2">
        <a href="#test-coverage">Test coverage</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="amqp-0-9-1-library-and-client-for-node.js">
  <h1>
    <a href="#amqp-0-9-1-library-and-client-for-node.js" name="amqp-0-9-1-library-and-client-for-node.js" class="pilcrow"></a>
AMQP 0-9-1 library and client for Node.JS
  </h1>
</div>
<p><a href="https://travis-ci.org/squaremo/amqp.node"><img src="https://travis-ci.org/squaremo/amqp.node.png" alt="Build Status"></a></p>
<pre><code>npm install amqplib
</code></pre>
<ul>
<li><a href="https://github.com/squaremo/amqp.node/blob/master/CHANGELOG.md">Change log</a></li>
<li><a href="http://squaremo.github.com/amqp.node/">GitHub pages</a></li>
<li><a href="http://squaremo.github.com/amqp.node/channel_api.html">API reference</a></li>
<li><a href="https://github.com/squaremo/amqp.node/tree/master/examples/tutorials">Examples from RabbitMQ tutorials</a></li>
</ul>
<p>A library for making AMQP 0-9-1 clients for Node.JS, and an AMQP 0-9-1
client for Node.JS v0.8-0.12, v4-v9, and the intervening io.js
releases.</p>
<p>This library does not implement <a href="https://github.com/squaremo/amqp.node/issues/63">AMQP
1.0</a> or <a href="https://github.com/squaremo/amqp.node/issues/94">AMQP
0-10</a>.</p>
<p>Project status:</p>
<ul>
<li>Expected to work</li>
<li>Complete high-level and low-level APIs (i.e., all bits of the protocol)</li>
<li>Stable APIs</li>
<li>A fair few tests</li>
<li>Measured test coverage</li>
<li>Ports of the <a href="http://www.rabbitmq.com/getstarted.html">RabbitMQ tutorials</a> as <a href="https://github.com/squaremo/amqp.node/tree/master/examples/tutorials">examples</a></li>
<li>Used in production</li>
</ul>
<p>Still working on:</p>
<ul>
<li>Getting to 100% (or very close to 100%) test coverage</li>
</ul>
<div class="pilwrap" id="callback-api-example">
  <h2>
    <a href="#callback-api-example" name="callback-api-example" class="pilcrow"></a>
Callback API example
  </h2>
</div>
<pre><code class="javascript"><span class="hljs-keyword">var</span> q = <span class="hljs-string">'tasks'</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bail</span>(<span class="hljs-params">err</span>) </span>{
  <span class="hljs-built_in">console</span>.error(err);
  process.exit(<span class="hljs-number">1</span>);
}

<span class="hljs-comment">// Publisher</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">publisher</span>(<span class="hljs-params">conn</span>) </span>{
  conn.createChannel(on_open);
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on_open</span>(<span class="hljs-params">err, ch</span>) </span>{
    <span class="hljs-keyword">if</span> (err != <span class="hljs-literal">null</span>) bail(err);
    ch.assertQueue(q);
    ch.sendToQueue(q, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">'something to do'</span>));
  }
}

<span class="hljs-comment">// Consumer</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">consumer</span>(<span class="hljs-params">conn</span>) </span>{
  <span class="hljs-keyword">var</span> ok = conn.createChannel(on_open);
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on_open</span>(<span class="hljs-params">err, ch</span>) </span>{
    <span class="hljs-keyword">if</span> (err != <span class="hljs-literal">null</span>) bail(err);
    ch.assertQueue(q);
    ch.consume(q, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
      <span class="hljs-keyword">if</span> (msg !== <span class="hljs-literal">null</span>) {
        <span class="hljs-built_in">console</span>.log(msg.content.toString());
        ch.ack(msg);
      }
    });
  }
}

<span class="hljs-built_in">require</span>(<span class="hljs-string">'amqplib/callback_api'</span>)
  .connect(<span class="hljs-string">'amqp://localhost'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, conn</span>) </span>{
    <span class="hljs-keyword">if</span> (err != <span class="hljs-literal">null</span>) bail(err);
    consumer(conn);
    publisher(conn);
  });
</code></pre>
<div class="pilwrap" id="promise-api-example">
  <h2>
    <a href="#promise-api-example" name="promise-api-example" class="pilcrow"></a>
Promise API example
  </h2>
</div>
<pre><code class="javascript"><span class="hljs-keyword">var</span> q = <span class="hljs-string">'tasks'</span>;

<span class="hljs-keyword">var</span> open = <span class="hljs-built_in">require</span>(<span class="hljs-string">'amqplib'</span>).connect(<span class="hljs-string">'amqp://localhost'</span>);

<span class="hljs-comment">// Publisher</span>
open.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conn</span>) </span>{
  <span class="hljs-keyword">return</span> conn.createChannel();
}).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ch</span>) </span>{
  <span class="hljs-keyword">return</span> ch.assertQueue(q).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ok</span>) </span>{
    <span class="hljs-keyword">return</span> ch.sendToQueue(q, <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">'something to do'</span>));
  });
}).catch(<span class="hljs-built_in">console</span>.warn);

<span class="hljs-comment">// Consumer</span>
open.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conn</span>) </span>{
  <span class="hljs-keyword">return</span> conn.createChannel();
}).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ch</span>) </span>{
  <span class="hljs-keyword">return</span> ch.assertQueue(q).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ok</span>) </span>{
    <span class="hljs-keyword">return</span> ch.consume(q, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
      <span class="hljs-keyword">if</span> (msg !== <span class="hljs-literal">null</span>) {
        <span class="hljs-built_in">console</span>.log(msg.content.toString());
        ch.ack(msg);
      }
    });
  });
}).catch(<span class="hljs-built_in">console</span>.warn);
</code></pre>
<div class="pilwrap" id="running-tests">
  <h2>
    <a href="#running-tests" name="running-tests" class="pilcrow"></a>
Running tests
  </h2>
</div>
<pre><code>npm test
</code></pre>
<p>To run the tests RabbitMQ is required. Either install it with your package
manager, or use <a href="https://www.docker.com/">docker</a> to run a RabbitMQ instance.</p>
<pre><code>docker run -d --name amqp.test -p 5672:5672 rabbitmq
</code></pre>
<p>If prefer not to run RabbitMQ locally it is also possible to use a
instance of RabbitMQ hosted elsewhere. Use the <code>URL</code> environment
variable to configure a different amqp host to connect to. You may
also need to do this if docker is not on localhost; e.g., if it's
running in docker-machine.</p>
<p>One public host is dev.rabbitmq.com:</p>
<pre><code>URL=amqp://dev.rabbitmq.com npm test
</code></pre>
<p><strong>NB</strong> You may experience test failures due to timeouts if using the
dev.rabbitmq.com instance.</p>
<p>You can run it under different versions of Node.JS using <a href="https://github.com/isaacs/nave">nave</a>:</p>
<pre><code>nave use 0.8 npm test
</code></pre>
<p>or run the tests on all supported versions of Node.JS in one go:</p>
<pre><code>make test-all-nodejs
</code></pre>
<p>(which also needs <code>nave</code> installed, of course).</p>
<p>Lastly, setting the environment variable <code>LOG_ERRORS</code> will cause the
tests to output error messages encountered, to the console; this is
really only useful for checking the kind and formatting of the errors.</p>
<pre><code>LOG_ERRORS=true npm test
</code></pre>
<div class="pilwrap" id="test-coverage">
  <h2>
    <a href="#test-coverage" name="test-coverage" class="pilcrow"></a>
Test coverage
  </h2>
</div>
<pre><code>make coverage
open file://`pwd`/coverage/lcov-report/index.html
</code></pre>
</div>
  </div>
</body>
</html>
