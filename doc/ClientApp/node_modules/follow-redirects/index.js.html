<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "ClientApp\\node_modules\\follow-redirects\\index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">'use strict'</span>;
<span class="hljs-keyword">var</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);
<span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'assert'</span>);
<span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">var</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">'https'</span>);
<span class="hljs-keyword">var</span> Writable = <span class="hljs-built_in">require</span>(<span class="hljs-string">'stream'</span>).Writable;
<span class="hljs-keyword">var</span> debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'follow-redirects'</span>);

<span class="hljs-keyword">var</span> nativeProtocols = {<span class="hljs-string">'http:'</span>: http, <span class="hljs-string">'https:'</span>: https};
<span class="hljs-keyword">var</span> schemes = {};
<span class="hljs-keyword">var</span> exports = <span class="hljs-built_in">module</span>.exports = {
	<span class="hljs-attr">maxRedirects</span>: <span class="hljs-number">21</span>
};
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>RFC7231§4.2.1: Of the request methods defined by this specification,
the GET, HEAD, OPTIONS, and TRACE methods are defined to be safe.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> safeMethods = {<span class="hljs-attr">GET</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">HEAD</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">OPTIONS</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">TRACE</span>: <span class="hljs-literal">true</span>};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Create handlers that pass events from native requests</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> eventHandlers = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
[<span class="hljs-string">'abort'</span>, <span class="hljs-string">'aborted'</span>, <span class="hljs-string">'error'</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
	eventHandlers[event] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{
		<span class="hljs-keyword">this</span>._redirectable.emit(event, arg);
	};
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>An HTTP(S) request that can be redirected</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">RedirectableRequest</span>(<span class="hljs-params">options, responseCallback</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Initialize the request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	Writable.call(<span class="hljs-keyword">this</span>);
	<span class="hljs-keyword">this</span>._options = options;
	<span class="hljs-keyword">this</span>._redirectCount = <span class="hljs-number">0</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Attach a callback if passed</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">if</span> (responseCallback) {
		<span class="hljs-keyword">this</span>.on(<span class="hljs-string">'response'</span>, responseCallback);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>React to responses of native requests</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
	<span class="hljs-keyword">this</span>._onNativeResponse = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>{
		self._processResponse(response);
	};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Perform the first request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">this</span>._performRequest();
}
RedirectableRequest.prototype = <span class="hljs-built_in">Object</span>.create(Writable.prototype);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Executes the next native request (initial or redirect)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">RedirectableRequest.prototype._performRequest = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>If specified, use the agent corresponding to the protocol
(HTTP and HTTPS use different types of agents)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">var</span> protocol = <span class="hljs-keyword">this</span>._options.protocol;
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._options.agents) {
		<span class="hljs-keyword">this</span>._options.agent = <span class="hljs-keyword">this</span>._options.agents[schemes[protocol]];
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Create the native request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">var</span> nativeProtocol = nativeProtocols[<span class="hljs-keyword">this</span>._options.protocol];
	<span class="hljs-keyword">var</span> request = <span class="hljs-keyword">this</span>._currentRequest =
				nativeProtocol.request(<span class="hljs-keyword">this</span>._options, <span class="hljs-keyword">this</span>._onNativeResponse);
	<span class="hljs-keyword">this</span>._currentUrl = url.format(<span class="hljs-keyword">this</span>._options);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Set up event handlers</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	request._redirectable = <span class="hljs-keyword">this</span>;
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> event <span class="hljs-keyword">in</span> eventHandlers) {
		<span class="hljs-keyword">if</span> (event) {
			request.on(event, eventHandlers[event]);
		}
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>The first request is explicitly ended in RedirectableRequest#end</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._currentResponse) {
		request.end();
	}
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Processes a response from the current native request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">RedirectableRequest.prototype._processResponse = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>RFC7231§6.4: The 3xx (Redirection) class of status code indicates
that further action needs to be taken by the user agent in order to
fulfill the request. If a Location header field is provided,
the user agent MAY automatically redirect its request to the URI
referenced by the Location field value,
even if the specific status code is not understood.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">var</span> location = response.headers.location;
	<span class="hljs-keyword">if</span> (location &amp;&amp; <span class="hljs-keyword">this</span>._options.followRedirects !== <span class="hljs-literal">false</span> &amp;&amp;
			response.statusCode &gt;= <span class="hljs-number">300</span> &amp;&amp; response.statusCode &lt; <span class="hljs-number">400</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>RFC7231§6.4: A client SHOULD detect and intervene
in cyclical redirections (i.e., &quot;infinite&quot; redirection loops).</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		<span class="hljs-keyword">if</span> (++<span class="hljs-keyword">this</span>._redirectCount &gt; <span class="hljs-keyword">this</span>._options.maxRedirects) {
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'error'</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Max redirects exceeded.'</span>));
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>RFC7231§6.4.7: The 307 (Temporary Redirect) status code indicates
that the target resource resides temporarily under a different URI
and the user agent MUST NOT change the request method
if it performs an automatic redirection to that URI.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		<span class="hljs-keyword">if</span> (response.statusCode !== <span class="hljs-number">307</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>RFC7231§6.4: Automatic redirection needs to done with
care for methods not known to be safe […],
since the user might not wish to redirect an unsafe request.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">			<span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span>._options.method <span class="hljs-keyword">in</span> safeMethods)) {
				<span class="hljs-keyword">this</span>._options.method = <span class="hljs-string">'GET'</span>;
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>Perform the redirected request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		<span class="hljs-keyword">var</span> redirectUrl = url.resolve(<span class="hljs-keyword">this</span>._currentUrl, location);
		debug(<span class="hljs-string">'redirecting to'</span>, redirectUrl);
		<span class="hljs-built_in">Object</span>.assign(<span class="hljs-keyword">this</span>._options, url.parse(redirectUrl));
		<span class="hljs-keyword">this</span>._currentResponse = response;
		<span class="hljs-keyword">this</span>._performRequest();
	} <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>The response is not a redirect; return it as-is</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		response.responseUrl = <span class="hljs-keyword">this</span>._currentUrl;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'response'</span>, response);
	}
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>Aborts the current native request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">RedirectableRequest.prototype.abort = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">this</span>._currentRequest.abort();
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Ends the current native request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">RedirectableRequest.prototype.end = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, encoding, callback</span>) </span>{
	<span class="hljs-keyword">this</span>._currentRequest.end(data, encoding, callback);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>Flushes the headers of the current native request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">RedirectableRequest.prototype.flushHeaders = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">this</span>._currentRequest.flushHeaders();
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>Sets the noDelay option of the current native request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">RedirectableRequest.prototype.setNoDelay = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">noDelay</span>) </span>{
	<span class="hljs-keyword">this</span>._currentRequest.setNoDelay(noDelay);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>Sets the socketKeepAlive option of the current native request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">RedirectableRequest.prototype.setSocketKeepAlive = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">enable, initialDelay</span>) </span>{
	<span class="hljs-keyword">this</span>._currentRequest.setSocketKeepAlive(enable, initialDelay);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>Sets the timeout option of the current native request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">RedirectableRequest.prototype.setTimeout = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">timeout, callback</span>) </span>{
	<span class="hljs-keyword">this</span>._currentRequest.setTimeout(timeout, callback);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>Writes buffered data to the current native request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">RedirectableRequest.prototype._write = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk, encoding, callback</span>) </span>{
	<span class="hljs-keyword">this</span>._currentRequest.write(chunk, encoding, callback);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>Export a redirecting wrapper for each native protocol</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-built_in">Object</span>.keys(nativeProtocols).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">protocol</span>) </span>{
	<span class="hljs-keyword">var</span> scheme = schemes[protocol] = protocol.substr(<span class="hljs-number">0</span>, protocol.length - <span class="hljs-number">1</span>);
	<span class="hljs-keyword">var</span> nativeProtocol = nativeProtocols[protocol];
	<span class="hljs-keyword">var</span> wrappedProtocol = exports[scheme] = <span class="hljs-built_in">Object</span>.create(nativeProtocol);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>Executes an HTTP request, following redirects</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	wrappedProtocol.request = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">options, callback</span>) </span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options === <span class="hljs-string">'string'</span>) {
			options = url.parse(options);
			options.maxRedirects = exports.maxRedirects;
		} <span class="hljs-keyword">else</span> {
			options = <span class="hljs-built_in">Object</span>.assign({
				<span class="hljs-attr">maxRedirects</span>: exports.maxRedirects,
				<span class="hljs-attr">protocol</span>: protocol
			}, options);
		}
		assert.equal(options.protocol, protocol, <span class="hljs-string">'protocol mismatch'</span>);
		debug(<span class="hljs-string">'options'</span>, options);

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RedirectableRequest(options, callback);
	};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>Executes a GET request, following redirects</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	wrappedProtocol.get = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">options, callback</span>) </span>{
		<span class="hljs-keyword">var</span> request = wrappedProtocol.request(options, callback);
		request.end();
		<span class="hljs-keyword">return</span> request;
	};
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
